/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/util/MockServer","sap/base/Log","sap/base/util/UriParameters","sap/ui/util/XMLHelper","i2d/eam/workpermit/manages1/localService/mockutility/metadataTransformer","i2d/eam/workpermit/manages1/localService/mockutility/mockServerDraft"],function(M,L,U,X,a,b){"use strict";var m,_="i2d/eam/workpermit/manages1/",c=_+"localService/mockdata";return{init:function(){var u=new U(window.location.href),j=sap.ui.require.toUrl(c),s=sap.ui.require.toUrl(_+"manifest"+".json"),e="WorkPermit",E=u.get("errorType"),i=E==="badRequest"?400:500,o=jQuery.sap.syncGetJSON(s).data,d=o["sap.app"].dataSources,f=d.mainService,g=sap.ui.require.toUrl(_+f.settings.localUri.replace(".xml","")+".xml"),h=/.*\/$/.test(f.uri)?f.uri:f.uri+"/",A=f.settings.annotations,n="cds_ui_workpermit";var k=new a();m=new M({rootUri:h});var l=m._loadMetadata;m._loadMetadata=function(q){var t=l.apply(m,[q]);t=k.modifyMetadataXML.apply(k,[t,n]);m._sMetadata=new XMLSerializer().serializeToString(t);return t;};M.config({autoRespond:true,autoRespondAfter:(u.get("serverDelay")||1000)});m.simulate(g,{sMockdataBaseUrl:j,bGenerateMissingMockData:false});var r=m.getRequests(),R=function(q,t,v){v.response=function(x){x.respond(q,{"Content-Type":"text/plain;charset=utf-8"},t);};};if(u.get("metadataError")){r.forEach(function(q){if(q.path.toString().indexOf("$metadata")>-1){R(500,"metadata Error",q);}});}if(E){r.forEach(function(q){if(q.path.toString().indexOf(e)>-1){R(i,E,q);}});}var p=new b(n,m,M);r=p.enhanceDraftHandling(r);M.prototype.setRequests.apply(m,[r]);m.start();L.info("Running the app with mock data");if(A&&A.length>0){A.forEach(function(q){var t=d[q],v=t.uri,w=sap.ui.require.toUrl(_+t.settings.localUri.replace(".xml","")+".xml");new M({rootUri:v,requests:[{method:"GET",path:new RegExp("([?#].*)?"),response:function(x){sap.ui.require("jquery.sap.xml");var y=jQuery.sap.sjax({url:w,dataType:"xml"}).data;x.respondXML(200,{},X.serialize(y));return true;}}]}).start();});}},getMockServer:function(){return m;}};});
