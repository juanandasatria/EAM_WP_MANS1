/*
 * Copyright (C) 2009-2023 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["i2d/eam/workpermit/manages1/ext/controller/ObjectPageExt.controller","i2d/eam/workpermit/manages1/formatter/Formatter","sap/ui/core/Fragment","sap/ui/model/FilterOperator","sap/ui/model/Filter","sap/m/MessageBox","sap/m/MessageToast","sap/m/TextArea","sap/m/SearchField","sap/m/Button","sap/ui/table/Column","sap/m/Label","sap/m/Text"],function(d,F,f,g,h,M,k,T,S,B,U,L,l){"use strict";return sap.ui.controller("i2d.eam.workpermit.manages1.ext.controller.ObjectPageExt",{onInit:function(e){this.sAppId=e.getParameter("id");this.oModel=this.getOwnerComponent().getModel();this.i18nModel=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.initializeTables();var r=sap.ui.core.UIComponent.getRouterFor(this);r.getRoute("WorkPermitquery").attachMatched(this._onRouteMatched,this);this.extensionAPI.attachPageDataLoaded(function(E){this.permitData=sap.ui.getCore().byId(this.sAppId+"--objectPage").getBindingContext().getObject();this.IsApproved=this.permitData.IsApproved;this.oEditBtnVisibility=sap.ui.getCore().byId(this.sAppId+"--edit");this.setDefaultValues();this.fnObjectPageLoad();sap.ui.getCore().byId(this.sAppId+"--AddORDEntry--permitButtonAssignOperation").setEnabled(false);sap.ui.getCore().byId(this.sAppId+"--AddORDEntry--permitButtonUnassignOrder").setEnabled(false);this.handleChangeStatusButtons();}.bind(this));sap.ui.getCore().byId(this.sAppId+"--objectPage").attachSectionChange(function(a){this.handleSectionChange(a.getSource().getSelectedSection());}.bind(this));this.addPrintButton();this.addSPRCellPopover();this.getApprovalField();var o=sap.ui.getCore().byId(this.sAppId+"--ord::responsiveTable");if(o){o.attachSelectionChange(this._onOrderTableSelectionChange,this);o.attachUpdateFinished(this._onOrderTableUpdate,this);}this.getOwnerComponent().getModel().attachBatchRequestCompleted(function(e){var p=e&&e.getParameters();if(p&&p.requests&&p.response.statusCode===202&&p.requests[0].response.statusCode==="200"){var u=p.requests[0].url;var s=this.sAppId+"--activate";if(u.startsWith("SubmitForApproval?")||u.startsWith("RevokeRelease?")||u.startsWith("Deactivate?")||u.startsWith("ActivateChanges?")||u.startsWith("SetProcessingStatusToClosed?")||u.startsWith("SetDeletionFlag?")||u.startsWith("RemoveDeletionFlag?")||u.startsWith("Cancel?")){if(this.getView().getBindingContext().getObject().IsActiveEntity){this.oModel.refresh();}else{jQuery.sap.delayedCall(5,this,function(){this.navigateToDisplayMode();});}}}}.bind(this));this.getOwnerComponent().getModel().attachBatchRequestCompleted(function(e){var p=e&&e.getParameters();if(p&&p.requests&&p.response.statusCode===202&&p.requests[0].response.statusCode==="200"){var u=p.requests[0].url;if(u.startsWith("WorkPermit")||u.startsWith("WorkPermitEdit")){try{if(this.getView().getBindingContext().getObject().WorkPermitProcessingStatus!=="PS50"){sap.ui.getCore().byId("idCombineChangeidSetIssueFlagButton").setVisible(false);sap.ui.getCore().byId("idCombineChangeidReissueWrkPmtButton").setVisible(false);}}catch(a){}}}}.bind(this));},_onRouteMatched:function(){this.getOwnerComponent().getModel("uiConfigModel").setProperty("/navigated",false);},getApprovalField:function(){var c=["PlainLongText","WorkPermitApprovalStatus"];var C=sap.ui.getCore().byId(this.sAppId+"--APPR1::Table");if(C){C.setRequestAtLeastFields(c);C.setIgnoreFromPersonalisation("PlainLongText,WorkPermitApprovalStatus");}var o=["RowIndex"];var O=sap.ui.getCore().byId(this.sAppId+"--ord::Table");if(O){O.setRequestAtLeastFields(o);O.setIgnoreFromPersonalisation("RowIndex");}},handleAuthError:function(e){M.error(JSON.parse(e.responseText).error.message.value);},onApplicationLogsPress:function(){var w,e,c;;w=this.getView().getBindingContext().getObject().WorkPermit;e="WORKPERMIT"+w;c=this.formatCreationDate();this.extensionAPI.getNavigationController().navigateExternal("ApplicationLog",{LogObjectId:"LOG_WCM_ML",LogExternalId:e,DateFrom:c});},formatCreationDate:function(){var c,a,b;c=this.getView().getBindingContext().getObject().CreationDateTime;a=c.getMonth()+1;b=c.getDate();if(a<10){a=a.toString().padStart(2,'0');}if(b<10){b=b.toString().padStart(2,'0');}var e=c.getFullYear()+""+a+""+b;return e;},_onOrderTableSelectionChange:function(e){this.handleOrderTableSelectionChange(e);},handleCloseExtPopupButton:function(e){this.idPermitValidity.setValueState("None");},_onOrderTableUpdate:function(e){if(this.permitData.WrkPmtOrdOpAssgmtIsAllowed){sap.ui.getCore().byId(this.sAppId+"--ExtensionWizard::ColumnBreakoutOperations").setVisible(true);}else{sap.ui.getCore().byId(this.sAppId+"--ExtensionWizard::ColumnBreakoutOperations").setVisible(false);}this.handleOrderTableSelectionChange(e);},handleOrderTableSelectionChange:function(e){if(e.getSource().getSelectedItems().length>=1){sap.ui.getCore().byId(this.sAppId+"--AddORDEntry--permitButtonAssignOperation").setEnabled(true);sap.ui.getCore().byId(this.sAppId+"--AddORDEntry--permitButtonUnassignOrder").setEnabled(true);}else{sap.ui.getCore().byId(this.sAppId+"--AddORDEntry--permitButtonAssignOperation").setEnabled(false);sap.ui.getCore().byId(this.sAppId+"--AddORDEntry--permitButtonUnassignOrder").setEnabled(false);}},handleOperationsValueHelp:function(e){var o=sap.ui.getCore().byId(this.sAppId+"--ord::responsiveTable");var s=o.getSelectedItem().getBindingContext();var a=s.getProperty("MaintenanceOrder");this.getAssignedOperations(a);this._oAssignOperationsValueHelpDialog=sap.ui.xmlfragment("i2d.eam.workpermit.manages1.ext.view.fragments.AssignOperations",this);this.getView().addDependent(this._oAssignOperationsValueHelpDialog);this._oBasicSearchField=new S({showSearchButton:true});var b=this._oAssignOperationsValueHelpDialog.getFilterBar();b.setFilterBarExpanded(false);b.setBasicSearch(this._oBasicSearchField);this._oBasicSearchField.attachSearch(function(){b.search();});var c=a;var m=this.getOwnerComponent().getModel();var i=new h({path:"MaintenanceOrder",operator:g.EQ,value1:c});var j=new sap.ui.table.Column({label:new sap.m.Label({text:this.i18nModel.getText("Input.OperationNo")}),template:new sap.m.Text({text:"{MaintenanceOrderOperation}"})});var n=new sap.ui.table.Column({label:new sap.m.Label({text:this.i18nModel.getText("Input.Description")}),template:new sap.m.Text({text:"{OperationDescription}"})});var w=new sap.ui.table.Column({label:new sap.m.Label({text:this.i18nModel.getText("WorkCenterFilterItemText")}),template:new sap.m.Text({text:"{WorkCenter}"})});var p=new sap.ui.table.Column({label:new sap.m.Label({text:this.i18nModel.getText("PlantNameFilterItemText")}),template:new sap.m.Text({text:"{Plant}"})});var q=new sap.ui.table.Column({label:new sap.m.Label({text:this.i18nModel.getText("SystemStatusFilterItemText")}),template:new sap.m.Text({text:"{ConcatenatedActiveSystStsName}"})});this._oAssignOperationsValueHelpDialog.getTableAsync().then(function(t){t.bindAggregation("rows",{path:"/OrderOperation",filters:i});t.setModel(m);t.addColumn(j);t.addColumn(n);t.addColumn(w);t.addColumn(p);t.addColumn(q);this._oAssignOperationsValueHelpDialog.update();}.bind(this));this._oAssignOperationsValueHelpDialog.open();},onOperationsFilterBarSearch:function(e){var s=this._oBasicSearchField.getValue(),a=e.getParameter("selectionSet");s=s;var b=a.reduce(function(r,c){if(c.getValue()){var i=c.getValue();r.push(new h({path:c.getName(),operator:g.Contains,value1:i}));}return r;},[]);b.push(new h({filters:[new h({path:"MaintenanceOrderOperation",operator:g.Contains,value1:s}),new h({path:"OperationDescription",operator:g.Contains,value1:s}),new h({path:"WorkCenter",operator:g.Contains,value1:s}),new h({path:"PlantName",operator:g.Contains,value1:s})],and:false}));this._filterOperationTable(new h({filters:b,and:true}));},_filterOperationTable:function(o){var v=this._oAssignOperationsValueHelpDialog;v.getTableAsync().then(function(t){if(t.bindRows){t.getBinding("rows").filter(o);}if(t.bindItems){t.getBinding("items").filter(o);}v.update();});},onOperationValueHelpOkPress:function(e){this.handleAssignOperationConfirm(e);this._oAssignOperationsValueHelpDialog.close();},getAssignedOperations:function(a){var w,b;w=this.getView().getBindingContext().getObject().WorkPermit;b=this.getView().getBindingContext().getObject().DraftUUID;this.oModel.read("/WrkPmtOrderOperation",{filters:[new h("WorkPermit",g.EQ,w),new h("ParentDraftUUID",g.EQ,b),new h("IsActiveEntity",g.EQ,false),new h("MaintenanceOrder",g.EQ,a)],success:function(D){this.AssignedOperations=D.results;}.bind(this),error:function(D){}.bind(this)});},handleAssignOperationConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var O=e.getSource(),c=sap.ui.getCore().byId(this.sAppId+"--ord::Table"),s=e.getSource().getTable().getSelectedIndices().length;if(e.getParameters().tokens.length>0){this._OperationLength=0;this.operationCount=0;for(var i=0;i<s;i++){this._OperationAvailable=false;var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()];this.oModel.setDeferredGroups(["NewOperationItems"]);for(var j=0;j<this.AssignedOperations.length;j++){if(I.MaintenanceOrderOperation===this.AssignedOperations[j].MaintenanceOrderOperation&&I.OperationDescription===this.AssignedOperations[j].OperationDescription){this._OperationAvailable=true;this._OperationLength+=1;break;}}if(this._OperationAvailable===false){this.operationCount+=1;this.oModel.createEntry(e.getSource().getBindingContext().sPath+"/to_WorkPermitOrderOperation",{groupId:"NewOperationItems",properties:{"OperationOrderRoutingNumber":I.MaintOrderRoutingNumber,"MaintenanceOrderOperation":I.MaintenanceOrderOperation,"OperationDescription":I.OperationDescription,"MaintenanceOrder":I.MaintenanceOrder,"MaintOrderOperationCounter":I.MaintOrderOperationCounter,"IsActiveEntity":false}});}}this.operationCount=this.operationCount+this.AssignedOperations.length;this.submitBatchChanges(O,c,"NewOperationItems");}else{sap.ui.core.BusyIndicator.hide();O.setBusy(false);O.close();O.destroy();}},UpdateOperationCount:function(o){var a=sap.ui.getCore().byId(this.sAppId+"--ord::responsiveTable");var s=a.getSelectedItem().getBindingContext();var b=s.getProperty("MaintenanceOrderInternalID");var p=a.getSelectedItem().getBindingContext().sPath;var c=sap.ui.getCore().byId(this.sAppId+"--ord::Table");var E={"MaintenanceOrderInternalID":b,"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"RowIndex":o,"DraftUUID":this.permitData.DraftUUID,"IsActiveEntity":false};this.oModel.update(p,E,{success:function(){c.rebindTable();},error:function(e){}});},onOperationValueHelpCancelPress:function(){this._oAssignOperationsValueHelpDialog.close();},handlePressDisplayOperationList:function(e){var a=e.getSource().getBindingContext().getProperty("MaintenanceOrder");var W=this.getView().getBindingContext().getProperty("WorkPermit");var o=new h({filters:[new sap.ui.model.Filter({path:"WorkPermit",operator:sap.ui.model.FilterOperator.EQ,value1:W}),new sap.ui.model.Filter({path:"IsActiveEntity",operator:sap.ui.model.FilterOperator.EQ,value1:true}),new sap.ui.model.Filter({path:"MaintenanceOrder",operator:sap.ui.model.FilterOperator.EQ,value1:a})],and:true});this.displayAssignedOperationList(o,a,e);},handlePressEditOperationList:function(e){var a=e.getSource().getBindingContext().getProperty("MaintenanceOrder");var W=this.getView().getBindingContext().getProperty("WorkPermit");var b=this.getView().getBindingContext().getProperty("DraftUUID");var o=new h({filters:[new sap.ui.model.Filter({path:"WorkPermit",operator:sap.ui.model.FilterOperator.EQ,value1:W}),new sap.ui.model.Filter({path:"ParentDraftUUID",operator:sap.ui.model.FilterOperator.EQ,value1:b}),new sap.ui.model.Filter({path:"IsActiveEntity",operator:sap.ui.model.FilterOperator.EQ,value1:false}),new sap.ui.model.Filter({path:"MaintenanceOrder",operator:sap.ui.model.FilterOperator.EQ,value1:a})],and:true});this.displayAssignedOperationList(o,a,e);},displayAssignedOperationList:function(o,a,e){var b=e.getSource(),v=this.getView(),t=this;var s=this.i18nModel.getText("AssignedOperationsforOrderText")+" "+a;if(!this._oSelectedOperationsListPopover){this._oSelectedOperationsListPopover=f.load({id:v.getId(),name:"i2d.eam.workpermit.manages1.ext.view.fragments.SelectedOperationList",controller:this}).then(function(p){v.addDependent(p);return p;});}this._oSelectedOperationsListPopover.then(function(p){sap.ui.getCore().byId(p.getId()).setTitle(s);var c=sap.ui.getCore().byId(t.sAppId+"--SelectedOperationTable");if(c){c.attachRowSelectionChange(t._onOperationTableSelectionChange,t);}c.bindAggregation("rows",{path:"/WrkPmtOrderOperation",filters:o});p.openBy(b);});},handleSelectedOperationsListCloseButton:function(e){this.byId("SelectedOperationPopover").close();},_onOperationTableSelectionChange:function(e){if(e.getSource().getSelectedIndices().length>0){sap.ui.getCore().byId(this.sAppId+"--unAssignOperationAction").setEnabled(true);}else{sap.ui.getCore().byId(this.sAppId+"--unAssignOperationAction").setEnabled(false);}},onPressUnassignOperation:function(e){var s=sap.ui.getCore().byId(this.sAppId+"--SelectedOperationTable");var a=s.getRows();var b=s.getSelectedIndices();var m=this.oModel;var c=this.permitData.DraftUUID;var W=this.getView().getBindingContext().getProperty("WorkPermitInternalID");var o=sap.ui.getCore().byId(this.sAppId+"--ord::Table");m.setDeferredGroups(m.getDeferredGroups().concat(["UnAssignOperationGroup"]));M.warning(this.i18nModel.getText("Error.OrderDelete"),{title:this.i18nModel.getText("Title.Delete"),actions:[M.Action.DELETE,M.Action.CANCEL],emphasizedAction:M.Action.DELETE,onClose:function(A){if(A==="DELETE"){s.setBusy(true);b.forEach(function(i){var j=a[i].getBindingContext().getObject();m.callFunction("/UnassignJobs",{method:"POST",groupId:"UnAssignOperationGroup",changeSetId:i,urlParameters:{"WorkPermit":j.WorkPermit,"MaintenanceOrder":j.MaintenanceOrder,"MaintOrderRoutingNumber":j.OperationOrderRoutingNumber,"WorkPermitInternalID":W,"OperationOrderRoutingNumber":j.OperationOrderRoutingNumber,"MaintenanceOrderOperation":j.MaintenanceOrderOperation,"MaintOrderOperationCounter":j.MaintOrderOperationCounter,"MaintOrderOperationInternalID":j.MaintOrderOperationInternalID,"DraftUUID":c,"WrkPmtOrderOperationDraftUUID":j.DraftUUID,"IsActiveEntity":j.IsActiveEntity}});});m.submitChanges({batchGroupId:"UnAssignOperationGroup",success:function(D){s.getModel().refresh();s.setBusy(false);o.rebindTable();}.bind(this),error:function(E){s.setBusy(false);}});}}.bind(this)});},addSPRCellPopover:function(){sap.ui.getCore().byId(this.sAppId+"--SPR::Table").attachFieldChange(function(e){var s=e.getParameters().changeEvent.getSource().getBindingPath("value");var i=e.getParameters().changeEvent.getParameter("newValue");if(s==="WrkPmtSftyRqmtIsImplemented"&&i){var p=e.getParameters().changeEvent.getSource();if(!this.oPopover){this.oPopover=new sap.m.ResponsivePopover({title:this.i18nModel.getText("SPRPopoverTitleMsg")});}this.oPopover.openBy(p);}else if(s==="WrkPmtSftyRqmtIsImplemented"&&!i&&this.oPopover){var _=setInterval(function(){this.oPopover.fireAfterClose();clearInterval(_);}.bind(this),1000);}}.bind(this));},addPrintButton:function(){var m=new sap.m.Menu({id:"idPrintmenu",itemSelected:function(e){},items:[new sap.m.MenuItem({id:"idPrint",text:this.i18nModel.getText("Print"),tooltip:this.i18nModel.getText("Print"),press:this.onClickPrint.bind(this)}),new sap.m.MenuItem({id:"PrintDraft",text:this.i18nModel.getText("PrintDraft"),tooltip:this.i18nModel.getText("PrintDraft"),press:this.onClickPrint.bind(this)})]});var a=new sap.m.MenuButton("PrintPageMenuButtonddIdStatus",{text:this.i18nModel.getText("Btn.PrintMenu"),type:"Default",visible:true,tooltip:this.i18nModel.getText("Btn.PrintMenu"),menu:m});var o=sap.ui.getCore().byId(this.sAppId+"--template::ObjectPage::ObjectPageHeader");var s;for(var r=0;r<o.getActions().length;r++){if(o.getActions()[1].getId().search("Share")){s=r;break;}}o.insertAction(a,s-1);},handleChangeStatusButtons:function(e){if(this.permitData.WorkPermit!==""&&!this.oEditBtnVisibility.getVisible()&&this.permitData.DraftUUID==="00000000-0000-0000-0000-000000000000"){this.callCheckAuthAction(false);}else if(this.permitData.WorkPermit!==""&&this.oEditBtnVisibility.getVisible()){this.callCheckAuthAction(true);}else{sap.ui.getCore().byId("PrintPageMenuButtonddIdStatus").setVisible(false);sap.ui.getCore().byId(this.sAppId+"--action::cds_ui_workpermit.cds_ui_workpermit_Entities::ExtendWorkPermit").setVisible(false);if(this.permitData.SystemStatusText==""){this.getView().byId("action::idSetIssueFlagButton").setVisible(false);this.getView().byId("action::idReissueWrkPmtButton").setVisible(false);}}},callCheckAuthAction:function(e){sap.ui.getCore().byId(this.sAppId+"--template::ObjectPage::ObjectPageHeader-_actionsToolbar").setBlocked(true);this.isActive=sap.ui.getCore().byId(this.sAppId+"--template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle").getBindingContext().getObject().IsActiveEntity;var D=JSON.parse(this.permitData.WrkPmtChgStsActnEnbldVal).actions[0];if(e||this.isActive){this.handleChangeStatusButtonOnEdit(D);}else{this.handleChangeStatusButtonOnDisplay(D);}sap.ui.getCore().byId(this.sAppId+"--template::ObjectPage::ObjectPageHeader-_actionsToolbar").setBlocked(false);},handleChangeStatusButtonOnDisplay:function(D){sap.ui.getCore().byId("PrintPageMenuButtonddIdStatus").setVisible(true);if(D.workpermitprintisallowed&&!this.oEditBtnVisibility.getVisible()){sap.ui.getCore().byId("idPrint").setEnabled(D.workpermitprintisallowed);sap.ui.getCore().byId("PrintDraft").setEnabled(D.workpermitprintdraftisallowed);}if(this.permitData.WorkPermitProcessingStatus!=="PS50"){sap.ui.getCore().byId("idCombineChangeidSetIssueFlagButton").setVisible(false);sap.ui.getCore().byId("idCombineChangeidReissueWrkPmtButton").setVisible(false);}else{sap.ui.getCore().byId("idCombineChangeidSetIssueFlagButton").setVisible(D.workpermitisissued);}sap.ui.getCore().byId("idCombineChangeidReissueWrkPmtButton").setVisible(D.workpermitreissueisallowed);var o=sap.ui.getCore().byId("idCombineChangeStatusDeactivate");if(o){if(this.permitData.SystemStatusText.includes("I0642")){o.setText(this.i18nModel.getText("idReturnandDeactivate"));}else{o.setText(this.i18nModel.getText("idSetInactiveFlagButton"));}}var c=sap.ui.getCore().byId("idCombineChangeStatusSetProcessingStatusToClosed");if(c){if(this.permitData.SystemStatusText.includes("I0642")){c.setText(this.i18nModel.getText("idReturnandClose"));}else{c.setText(this.i18nModel.getText("idCloseWorkPermitButton"));}}},handleChangeStatusButtonOnEdit:function(D){sap.ui.getCore().byId("idCombineChangeidSetIssueFlagButton").setVisible(false);sap.ui.getCore().byId("idCombineChangeidReissueWrkPmtButton").setVisible(false);sap.ui.getCore().byId("PrintPageMenuButtonddIdStatus").setVisible(false);},initializeTables:function(){if(sap.ui.getCore().byId(this.sAppId+"--NOW::Table")){sap.ui.getCore().byId(this.sAppId+"--NOW::Table").setShowRowCount(false);}if(sap.ui.getCore().byId(this.sAppId+"--SPR::Table")){sap.ui.getCore().byId(this.sAppId+"--SPR::Table").setEnableAutoColumnWidth(false);sap.ui.getCore().byId(this.sAppId+"--SPR::Table").setHeader(this.i18nModel.getText("Title.SPRTable"));sap.ui.getCore().byId(this.sAppId+"--SPR::Table").getTable().setMode("SingleSelectMaster");}if(sap.ui.getCore().byId(this.sAppId+"--PPE::Table")){sap.ui.getCore().byId(this.sAppId+"--PPE::Table").setEnableAutoColumnWidth(false);sap.ui.getCore().byId(this.sAppId+"--PPE::Table").setHeader(this.i18nModel.getText("Title.PPETable"));sap.ui.getCore().byId(this.sAppId+"--PPE::Table").getTable().setMode("SingleSelectMaster");}if(sap.ui.getCore().byId(this.sAppId+"--ord::Table")){sap.ui.getCore().byId(this.sAppId+"--ord::Table").setEnableAutoColumnWidth(false);sap.ui.getCore().byId(this.sAppId+"--ord::Table").getTable().setMode("SingleSelectMaster");}if(sap.ui.getCore().byId(this.sAppId+"--TechObj::Table")){sap.ui.getCore().byId(this.sAppId+"--TechObj::Table").setEnableAutoColumnWidth(false);sap.ui.getCore().byId(this.sAppId+"--TechObj::Table").getTable().setMode("SingleSelectMaster");}if(sap.ui.getCore().byId(this.sAppId+"--Partner::Table")){sap.ui.getCore().byId(this.sAppId+"--Partner::Table").setEnableAutoColumnWidth(false);sap.ui.getCore().byId(this.sAppId+"--Partner::Table").getTable().setMode("SingleSelectMaster");}if(sap.ui.getCore().byId(this.sAppId+"--APPR1::Table")){sap.ui.getCore().byId(this.sAppId+"--APPR1::Table").setEnableAutoColumnWidth(false);sap.ui.getCore().byId(this.sAppId+"--APPR1::Table").getTable().setMode("SingleSelectMaster");}if(sap.ui.getCore().byId(this.sAppId+"--APPR2::Table")){sap.ui.getCore().byId(this.sAppId+"--APPR2::Table").setEnableAutoColumnWidth(false);}if(sap.ui.getCore().byId(this.sAppId+"--SC::Table")){sap.ui.getCore().byId(this.sAppId+"--SC::Table").setEnableAutoColumnWidth(false);}if(sap.ui.getCore().byId(this.sAppId+"--PA::Table")){sap.ui.getCore().byId(this.sAppId+"--PA::Table").setEnableAutoColumnWidth(false);}},handleSectionChange:function(s){if(s.includes("--GENDATA::Section")){this.setTableFilter(this.sAppId+"--NOW::responsiveTable","NOW");}if(s.includes("--CDATA1::Section")){sap.ui.getCore().byId(this.sAppId+"--PPE::Table").rebindTable();sap.ui.getCore().byId(this.sAppId+"--SPR::Table").rebindTable();this.setTableFilter(this.sAppId+"--PPE::responsiveTable","PPE");this.setTableFilter(this.sAppId+"--SPR::responsiveTable","SPR");}if(s.includes("--TechObj::Section")){sap.ui.getCore().byId(this.sAppId+"--TechObj::Table").rebindTable();this.setAddObjectVisible("--TechObj::responsiveTable","--ActionTechObjSection");}if(s.includes("--Partner::Section")){sap.ui.getCore().byId(this.sAppId+"--Partner::Table").rebindTable();this.setAddObjectVisible("--Partner::responsiveTable","--ActionPartnerSection");}if(s.includes("--APRV::Section")){sap.ui.getCore().byId(this.sAppId+"--APPR1::Table").rebindTable();var c=sap.ui.getCore().byId(this.sAppId+"--APPR1::responsiveTable").getColumns();var t;for(var i=0;i<c.length;i++){if(c[i].getId().includes("com.sap.vocabularies.UI.v1.FieldGroup:23AppAction")){var a=c[i].getHeader().getText();if(t){c[i].setHeader(t.clone());c[i].getHeader().setText(a);}}else{t=c[i].getHeader();}}this.setAddObjectVisible("--APPR1::responsiveTable","--permitButtonAddApproval");this.setAddObjectVisible("--APPR2::responsiveTable","");}if(s.includes("--CDATA2::Section")){sap.ui.getCore().byId(this.sAppId+"--SC::Table").rebindTable();this.setAddObjectVisible("--SC::responsiveTable","--permitButtonAddSafetyCert");}if(s.includes("--attachmentReuseComponent::simple")&&this.getOwnerComponent().getModel("ui").getData()['editable']==false){var b=this.getOwnerComponent().getModel("ui").getData()['editable']?'C':'D',o="WCAAP",e=String(this.permitData.WorkPermit).padStart(12,'0');var A=sap.ui.getCore().byId(this.sAppId+"--attachmentReuseComponent::simple::Attachments::ComponentSubSection");A.getBlocks()[0].getComponentInstance().refresh(b,o,e);}},setAddObjectVisible:function(t,b){sap.ui.getCore().byId(this.sAppId+t).attachUpdateFinished(function(e){if(e.getSource().getId().includes("SC")&&this.oEditBtnVisibility.getVisible()===false){if((this.permitData.WrkPmtSftyCertAssgmtCtrlCode==="01"&&this.permitData.SystemStatusText.includes("I0611"))||(this.permitData.WrkPmtSftyCertAssgmtCtrlCode==="02"&&this.permitData.SystemStatusText.includes("I0175"))||(this.getOwnerComponent().getModel('ui').getData().editable===false)){sap.ui.getCore().byId(this.sAppId+"--permitButtonAddSafetyCert--permitButtonAddSafetyCert").setVisible(false);sap.ui.getCore().byId(this.sAppId+"--SC::deleteEntry").setVisible(false);sap.ui.getCore().byId(this.sAppId+"--SC::Table").getTable().setMode("None");}else{sap.ui.getCore().byId(this.sAppId+"--permitButtonAddSafetyCert--permitButtonAddSafetyCert").setVisible(true);sap.ui.getCore().byId(this.sAppId+"--SC::deleteEntry").setVisible(true);sap.ui.getCore().byId(this.sAppId+"--SC::Table").getTable().setMode("SingleSelectLeft");}}if(this.oEditBtnVisibility||this.oResetDelBtnVisible||this.oResetInacBtnVisible){var I=e.getSource().getItems();for(var i=0;i<I.length;i++){if(e.getSource().getId().includes("Partner")){for(var c=0;c<I[i].getCells().length;c++){if(!this.IsApproved){if(sap.ui.getCore().byId(this.sAppId+t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("Input.Description")||sap.ui.getCore().byId(this.sAppId+t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("Input.PartnerFunction")||sap.ui.getCore().byId(this.sAppId+t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("Input.PartnerName")||sap.ui.getCore().byId(this.sAppId+t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("Label.PlanningPlant")){I[i].getCells()[c].setEditable(false);}}else{I[i].getCells()[c].setEditable(false);}}}}}if(e.getSource().getId().includes("ord")){for(i=0;i<e.getSource().getColumns().length;i++){if(e.getSource().getColumns()[i].getId().includes("MaintOrderRoutingNumber")){e.getSource().getColumns()[i].setVisible(false);}}}if(e.getSource().getId().includes("APPR2")){for(i=0;i<e.getSource().getColumns().length;i++){if(e.getSource().getColumns()[i].getId().includes("PlainLongText")){e.getSource().getColumns()[i].setVisible(false);}if(e.getSource().getColumns()[i].getId().includes("WorkPermitRevokeLongText")){e.getSource().getColumns()[i].setVisible(false);}}var a=e.getSource().indexOfColumn(sap.ui.getCore().byId(this.sAppId+"--ExtensionWizard::ColumnBreakoutLongTextHistory"));var j=e.getSource().indexOfColumn(sap.ui.getCore().byId(this.sAppId+"--ExtensionWizard::ColumnBreakoutRevokeTextHistory"));for(i=0;i<e.getSource().getItems().length;i++){var o=e.getSource().getItems();if(o[i].getBindingContext().getObject().PlainLongText){o[i].getCells()[a].setType("Emphasized");}else{o[i].getCells()[a].setType("Transparent");}if(o[i].getBindingContext().getObject().WorkPermitRevokeLongText){o[i].getCells()[j].setType("Emphasized");}else{o[i].getCells()[j].setType("Transparent");}}}if(e.getSource().getId().includes("APPR1")){}}.bind(this));},setDefaultValues:function(){this.mGroupFunctions={groupdescription:function(c){var n=c.getProperty("WrkPmtSftyRequirementGroupText");return{key:n,text:n};}};sap.ui.getCore().byId(this.sAppId+"--objectPage").setShowHeaderContent(true);this.oColModel=new sap.ui.model.json.JSONModel({"cols":[{"label":this.i18nModel.getText("Title.Description"),"template":"WrkPmtSafetyRequirementText"},{"label":this.i18nModel.getText("Title.Category"),"template":"WrkPmtSftyRequirementGroupText"}]});this.oTechObjColModel=new sap.ui.model.json.JSONModel({"cols":[{"label":this.i18nModel.getText("Title.TechObj"),"template":"TechnicalObjectLabel"},{"label":this.i18nModel.getText("Label.PlanningPlant"),"template":"MaintenancePlanningPlant"},{"label":this.i18nModel.getText("Title.TechObjType"),"template":"TechObjIsEquipOrFuncnlLocDesc"},{"label":this.i18nModel.getText("Title.TechObjDescription"),"template":"TechnicalObjectDescription"},{"label":this.i18nModel.getText("Title.TechWorkCenter"),"template":"WorkCenter"}]});this.oOrderColModel=new sap.ui.model.json.JSONModel({"cols":[{"label":this.i18nModel.getText("Input.OrderNo"),"template":"MaintenanceOrder"},{"label":this.i18nModel.getText("Title.OrdersDesc"),"template":"MaintenanceOrderDesc"},{"label":this.i18nModel.getText("Title.OrdersType"),"template":"MaintenanceOrderType"},{"label":this.i18nModel.getText("Label.PlanningPlant"),"template":"MaintenancePlanningPlant"}]});this.oApprovalsColModel=new sap.ui.model.json.JSONModel({"cols":[{"label":this.i18nModel.getText("Title.ApprovalType"),"template":"WorkPermitApproval"},{"label":this.i18nModel.getText("Title.ApprovalDescription"),"template":"WorkPermitApprovalDescription"},{"label":this.i18nModel.getText("Title.ApprovalRequirement"),"template":"WrkPmtApprvlMandText"}]});},fnObjectPageLoad:function(){var H=window.location.href,P,a,i=decodeURIComponent(H).includes("WorkPermit=''"),b=this.getOwnerComponent().getModel("uiConfigModel").getProperty("/navigated");if(sap.ui.getCore().byId(this.sAppId+"--header::headerEditable::PlanningPlant::MaintenancePlanningPlant::Field")){P=sap.ui.getCore().byId(this.sAppId+"--header::headerEditable::PlanningPlant::MaintenancePlanningPlant::Field").getValue();}if(sap.ui.getCore().byId(this.sAppId+"--header::headerEditable::PlanningPlant::WorkPermitType::Field")){a=sap.ui.getCore().byId(this.sAppId+"--header::headerEditable::PlanningPlant::WorkPermitType::Field").getValue();}var c=this.getView().getBindingContext().getObject().HasActiveEntity;if((i===true&&!b)&&(P===""||a===""||!c)){this.onClickCreatePermitPopUp();this.duplicateKey=this.onCreatePermitDialog.getBindingContext().getObject().DraftUUID;}if(b===true){this.getOwnerComponent().getModel("uiConfigModel").setProperty("/navigated",false);}},setTableFilter:function(t,o){if(sap.ui.getCore().byId(t)){sap.ui.getCore().byId(t).attachUpdateStarted(function(e){if(!sap.ui.getCore().byId(t).getVisible()){sap.ui.getCore().byId(t).setVisible(true);}sap.ui.getCore().byId(t).setAutoPopinMode(false);}.bind(this));sap.ui.getCore().byId(t).attachUpdateFinished(function(e){if(!e.getSource().getId().includes("NOW")){if(sap.ui.getCore().byId(this.sAppId+"PPE")){sap.ui.getCore().byId(this.sAppId+"PPE").setVisible(!this.oEditBtnVisibility.getVisible()||!this.oResetDelBtnVisible.getVisible()||!this.oResetInacBtnVisible.getVisible());}if(sap.ui.getCore().byId(this.sAppId+"SPR")){sap.ui.getCore().byId(this.sAppId+"SPR").setVisible(!this.oEditBtnVisibility.getVisible()||!this.oResetDelBtnVisible.getVisible()||!this.oResetInacBtnVisible.getVisible());}e.getSource().getItems().forEach(function(a){if(!a.isGroupHeader()){for(var c=0;c<a.getCells().length;c++){if(sap.ui.getCore().byId(t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("Title.Category")||sap.ui.getCore().byId(t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("Title.Description")||sap.ui.getCore().byId(t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("ImplementationStatusText")||sap.ui.getCore().byId(t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("ImplementedOnText")||sap.ui.getCore().byId(t).getColumns()[c].getHeader().getText()===this.i18nModel.getText("ImplementedByText")){a.getCells()[c].setEditable(false);}a.setHighlight("None");if(a.getDeleteControl()){a.getDeleteControl().setIcon("sap-icon://delete");if(!this.IsApproved){if(this.oEditBtnVisibility.getVisible()||this.oResetDelBtnVisible.getVisible()||this.oResetInacBtnVisible.getVisible()){a.getDeleteControl().setVisible(false);}}}}}}.bind(this));}if(e.getSource().getId().includes("SPR")){for(var i=0;i<sap.ui.getCore().byId(this.sAppId+"--SPR::Table").getTable().getColumns().length;i++){if(this.oEditBtnVisibility.getVisible()===true&&sap.ui.getCore().byId(this.sAppId+"--SPR::Table").getTable().getColumns()[i].getId().includes("WrkPmtSftyRqmtIsImplemented")){sap.ui.getCore().byId(this.sAppId+"--SPR::Table").getTable().getColumns()[i].setVisible(false);}}}}.bind(this));}},navigateToDisplayMode:function(){sap.ui.getCore().byId(this.sAppId+"--activate").firePress();},onClickCreatePermitPopUp:function(){if(!this.onCreatePermitDialog){this.onCreatePermitDialog=sap.ui.xmlfragment("idCreatePermitDialog","i2d.eam.workpermit.manages1.ext.view.fragments.CreatePermitPopUp",this);this.getView().addDependent(this.onCreatePermitDialog);}this.onCreatePermitDialog.open();this.idPlanningPlant=sap.ui.core.Fragment.byId("idCreatePermitDialog","permitInputPlanningPlant");this.idPermitType=sap.ui.core.Fragment.byId("idCreatePermitDialog","permitInputPermitType");this.idMaintorder=sap.ui.core.Fragment.byId("idCreatePermitDialog","permitInputMO");this.idRefObjTypSel=sap.ui.core.Fragment.byId("idCreatePermitDialog","refObjTypSel");this.idTemplNumRef=sap.ui.core.Fragment.byId("idCreatePermitDialog","permitInputTempNum");this.idWrkPmtRef=sap.ui.core.Fragment.byId("idCreatePermitDialog","wrkPmtRefernce");this.idPermitNum=sap.ui.core.Fragment.byId("idCreatePermitDialog","permitInputPermitNum");this.continueBtn=sap.ui.core.Fragment.byId("idCreatePermitDialog","permitButtonCreatePermit");this.clearCreatePermitFields();this.setCreatePermitParameterValues();jQuery.sap.delayedCall(500,this,function(){sap.ui.core.Fragment.byId("idCreatePermitDialog","permitInputPlanningPlant").focus();});},handleClosePermitButton:function(){this.onCreatePermitDialog.setBusy(true);this.oModel.resetChanges();this.oModel.callFunction("/WorkPermitDiscard",{method:"POST",urlParameters:{WorkPermit:"",DraftUUID:this.onCreatePermitDialog.getBindingContext().getObject().DraftUUID,IsActiveEntity:false},success:function(D,r){this.onCreatePermitDialog.setBusy(false);this.oModel.refresh();var H=window.location.href,i=decodeURIComponent(H).includes("preferredMode=create");if(i===true){window.hasher.replaceHash("");}else{history.back();}}.bind(this),error:function(D,r){this.onCreatePermitDialog.setBusy(false);}.bind(this)});},clearCreatePermitFields:function(){this.idPlanningPlant.setValue("");this.idPermitType.setValue("");this.idPermitNum.setValue("");this.idTemplNumRef.setValue("");this.idWrkPmtRef.setValue("");this.idMaintorder.setValue("");this.idPlanningPlant.setValueState("None");this.idPermitType.setValueState("None");this.idPermitNum.setValueState("None");this.idTemplNumRef.setValueState("None");this.idWrkPmtRef.setValueState("None");this.idMaintorder.setValueState("None");this.newPPValue="";this.newPTValue="";this.newRefValue="";this.newPermitNumValue="";sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementPermitNum").setVisible(false);sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementTempNum").setVisible(false);sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementNum").setVisible(false);},escapeHandler:function(p){p.resolve();this.handleClosePermitButton();},handleCreatePermitButton:function(){if(this.idTemplNumRef.getValueStateText()!==""){this.IsBlocked=true;}else{this.IsBlocked=false;}this.idPlanningPlant.setValueState("None");this.idPermitType.setValueState("None");this.idMaintorder.setValueState("None");this.idPermitNum.setValueState("None");this.idTemplNumRef.setValueStateText("");this.idTemplNumRef.setValueState("None");this.idWrkPmtRef.setValueStateText("");this.idWrkPmtRef.setValueState("None");this.idPlanningPlant.setValueStateText("");this.idPermitType.setValueStateText("");this.idMaintorder.setValueStateText("");this.idPermitNum.setValueStateText("");this.newMaintorder="";this.newTemplNumRef="";this.newWrkPmtRef="";this.newRefObjTyp="";this.newMaintorder=this.getView().getBindingContext().getObject().MaintenanceOrder;this.newTemplNumRef=this.getView().getBindingContext().getObject().WorkPermitReference;this.newWrkPmtRef=this.getView().getBindingContext().getObject().WorkPermitReferenceWorkPermit;var r=this.idRefObjTypSel.getInnerControls()[0];var a;if(r.getSelectedItem()){a=r.getSelectedItem().getBindingContext().getObject().WorkPermitReferenceObjectType;}if(a==="10"||a==="20"){this.newRefObjTyp=a;}this.callCreatePermitAction();},callCreatePermitAction:function(){this.onCreatePermitDialog.setBusy(true);this.oModel.callFunction("/CreateFromPopup",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.newPPValue,WorkPermitType:this.newPTValue,WorkPermitReferenceObjectType:this.newRefObjTyp,WorkPermitReference:this.newTemplNumRef,WorkPermitReferenceWorkPermit:this.newWrkPmtRef,MaintenanceOrder:this.newMaintorder,WorkPermitExternalNumber:this.idPermitNum.getValue(),DraftUUID:this.duplicateKey,ValidationScenarioID:"00002",IsActiveEntity:false,IsBlocked:this.IsBlocked},success:function(D,r){this.oModel.refresh();this.oModel.setRefreshAfterChange(true);this.oModel.resetChanges();this.onCreatePermitDialog.setBusy(false);this.onCreatePermitDialog.close();this.createSuccessFunction(D,r);}.bind(this),error:function(D,r){this.onCreatePermitDialog.setBusy(false);var E=JSON.parse(D.responseText).error.innererror.errordetails;E=E.sort(function(a,b){return parseInt(a.code.split("/")[1])-parseInt(b.code.split("/")[1]);});for(var i=0;i<E.length;i++){if(E[i].code==="I4/824"||E[i].code==="I4/001"){this.idPlanningPlant.setValueStateText(E[i].message);this.idPlanningPlant.setValueState("Error");return;}else if(E[i].code==="I4/820"||E[i].code==="I4/009"){this.idPermitType.setValueStateText(E[i].message);this.idPermitType.setValueState("Error");}else if(E[i].code==="I4/842"||E[i].code==="I4/843"||E[i].code==="I4/008"){this.idPermitNum.setValueStateText(E[i].message);this.idPermitNum.setValueState("Error");}else if(E[i].code==="I4/845"||E[i].code==="I4/846"||E[i].code==="I4/847"){this.idMaintorder.setValueStateText(E[i].message);this.idMaintorder.setValueState("Error");}else if(E[i].code==="I4/863"||E[i].code==="I4/865"||E[i].code==="I4/868"||E[i].code==="I4/887"||E[i].code==="I4/897"||E[i].code==="I4/888"||E[i].code==="I4/048"){this.idTemplNumRef.setValueStateText(E[i].message);this.idTemplNumRef.setValueState("Error");}else if(E[i].code==="I4/044"){this.idWrkPmtRef.setValueStateText(E[i].message);this.idWrkPmtRef.setValueState("Error");}else if(E[i].code==="I4/864"){if(this.newTemplNumRef){this.idTemplNumRef.setValueStateText(E[i].message);this.idTemplNumRef.setValueState("Error");}else{this.idWrkPmtRef.setValueStateText(E[i].message);this.idWrkPmtRef.setValueState("Error");}}else{M.error(E[i].message);}if(E[i].code==="I4/856"){this.continueBtn.setBlocked(true);M.error(E[i].message,{onClose:function(a){if(a==="CLOSE"){this.handleClosePermitButton();}}.bind(this)});}}}.bind(this)});},createSuccessFunction:function(D,r){this.permitData=sap.ui.getCore().byId(this.sAppId+"--objectPage").getBindingContext().getObject();var H=new sap.ui.core.routing.HashChanger(),n=H.getHash();n=n.replace(H.getHash().split(",")[1],"DraftUUID=guid'"+D.DraftUUID+"'");if(D.WorkPermit!==""){n=n.replace("WorkPermit=''","WorkPermit='"+D.WorkPermit+"'");}H.replaceHash(n);this.getOwnerComponent().getModel("uiConfigModel").setProperty("/navigated",true);},handlePlanningPlantValueChange:function(e){this.newPPValue=e.getParameters().newValue;this.validateAuthorization(this.newPPValue);},onChangeCopyFrom:function(e){var r=this.idRefObjTypSel.getInnerControls()[0];var a;if(r.getSelectedItem()){a=r.getSelectedItem().getBindingContext().getObject().WorkPermitReferenceObjectType;}if(a==="10"){sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementTempNum").setVisible(true);sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementNum").setVisible(false);this.idWrkPmtRef.setValue("");this.idWrkPmtRef.setEditable(false);this.idTemplNumRef.setEditable(true);}else if(a==="20"){sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementNum").setVisible(true);sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementTempNum").setVisible(false);this.idTemplNumRef.setValue("");this.idTemplNumRef.setEditable(false);this.idWrkPmtRef.setEditable(true);}else{sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementTempNum").setVisible(false);sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementNum").setVisible(false);this.idTemplNumRef.setValue("");this.idWrkPmtRef.setValue("");this.idTemplNumRef.setEditable(false);this.idWrkPmtRef.setEditable(false);}},validateAuthorization:function(){this.onCreatePermitDialog.setBusy(true);if(this.newPPValue.includes("(")&&this.newPPValue.includes(")")){this.newPPValue=this.newPPValue.split("(")[1].split(")")[0];}if(this.newPTValue===""){this.newPTValue=this.permitData.WorkPermitType;}this.oModel.callFunction("/CheckAuthorization",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.newPPValue,WorkPermit:this.permitData.WorkPermit,WorkPermitType:this.newPTValue,WorkPermitInternalID:this.permitData.WorkPermitInternalID,DraftUUID:this.permitData.DraftUUID,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){this.onCreatePermitDialog.setBusy(false);this.continueBtn.setBlocked(false);if(D.CheckAuthorization.WorkPermitType!==""){this.idPermitType.setValueState("None");if(D.CheckAuthorization.InternalNumberRangeInterval!==""&&D.CheckAuthorization.ExternalNumberRangeInterval!==""){sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementPermitNum").setVisible(true);this.idPermitNum.setRequired(false);jQuery.sap.delayedCall(0,this,function(){this.idPermitNum.focus();});}else if(D.CheckAuthorization.ExternalNumberRangeInterval!==""){sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementPermitNum").setVisible(true);this.idPermitNum.setRequired(true);jQuery.sap.delayedCall(0,this,function(){this.idPermitNum.focus();});}else if(D.CheckAuthorization.InternalNumberRangeInterval!==""){sap.ui.core.Fragment.byId("idCreatePermitDialog","permitGroupElementPermitNum").setVisible(false);}else{this.idPermitType.setValueState("Error");this.idPermitType.setValueStateText(this.i18nModel.getText("Error.RangeDoesNotExists1",[this.newPPValue,this.newPTValue]));}}}.bind(this),error:function(e){this.continueBtn.setBlocked(true);this.onCreatePermitDialog.setBusy(false);var m=JSON.parse(e.responseText).error;if(m.code==='I4/012'){this.idPlanningPlant.setValueState("Error");this.idPlanningPlant.setValueStateText(m.message.value);}else if(m.code==='I4/856'){this.idPermitType.setValueState("Error");this.idPermitType.setValueStateText(m.message.value);}else if(m.code==='I4/013'){M.error(m.message.value,{onClose:function(a){if(a==="CLOSE"){this.handleClosePermitButton();}}.bind(this)});}}.bind(this)});},validateTechn:function(){this.continueBtn.setBlocked(true);var t=new h("WorkAssignment",g.EQ,this.TechId);this.oModel.read("/C_EAMPersonWorkAgreementVH",{filters:[t],success:function(D){if(D.results.length>0){this.idTechnician.setValueState("None");this.continueBtn.setBlocked(false);}else{this.idTechnician.setValueState("Error");this.idTechnician.setValueStateText(this.i18nModel.getText("Error.TechDoesNotExists"));this.continueBtn.setBlocked(true);}}.bind(this),error:function(e){this.idTechnician.setValueState("Error");this.idTechnician.setValueStateText(this.i18nModel.getText("Error.TechDoesNotExists"));this.continueBtn.setBlocked(true);}.bind(this)});},handlePermitTypeValueChange:function(e){this.newPTValue=e.getParameters().newValue;if(this.newPTValue.includes("(")&&this.newPTValue.includes(")")){this.newPTValue=this.newPTValue.split("(")[1].split(")")[0];}if(this.newPPValue!==""&&this.idPlanningPlant.getValueState()==="None"){this.validateAuthorization();}else{this.idPlanningPlant.setValueState("Error");}},getSearchHelpFilters:function(i,s){var a;switch(true){case i.includes("PPE")||i.includes("SPR"):if(s.endsWith("*")){a=new h({filters:[new h("WrkPmtSftyRequirementGroupText",g.StartsWith,s.slice(0,-1)),new h("WrkPmtSafetyRequirementText",g.StartsWith,s.slice(0,-1))],and:false});}else{a=new h({filters:[new h("WrkPmtSftyRequirementGroupText",g.Contains,s),new h("WrkPmtSafetyRequirementText",g.Contains,s)],and:false});}break;case i.includes("TechObj"):if(s.endsWith("*")){a=new h({filters:[new h("TechnicalObjectLabel",g.StartsWith,s.slice(0,-1)),new h("TechObjIsEquipOrFuncnlLoc",g.StartsWith,s.slice(0,-1)),new h("TechnicalObjectDescription",g.StartsWith,s.slice(0,-1)),new h("WorkCenter",g.StartsWith,s.slice(0,-1))],and:false});}else{a=new h({filters:[new h("TechnicalObjectLabel",g.Contains,s),new h("TechObjIsEquipOrFuncnlLoc",g.Contains,s),new h("TechnicalObjectDescription",g.Contains,s),new h("WorkCenter",g.Contains,s)],and:false});}break;case i.includes("SafetyCert"):if(s.endsWith("*")){a=new h({filters:[new h("SafetyCertificate",g.StartsWith,s.slice(0,-1)),new h("SafetyCertificateType",g.StartsWith,s.slice(0,-1)),new h("TechnicalObjectLabel",g.StartsWith,s.slice(0,-1)),new h("SftyCertProcessingStatusText",g.StartsWith,s.slice(0,-1)),new h("MaintenancePlanningPlant",g.StartsWith,s.slice(0,-1)),],and:false});}else{a=new h({filters:[new h("SafetyCertificate",g.Contains,s),new h("SafetyCertificateType",g.Contains,s),new h("TechnicalObjectLabel",g.Contains,s),new h("SftyCertProcessingStatusText",g.Contains,s),new h("MaintenancePlanningPlant",g.Contains,s),],and:false});}break;case i.includes("Partner"):if(s.endsWith("*")){a=new h({filters:[new h("PartnerFunctionName",g.StartsWith,s.slice(0,-1)),new h("Partner",g.StartsWith,s.slice(0,-1)),new h("PartnerFullName",g.StartsWith,s.slice(0,-1))],and:false});}else{a=new h({filters:[new h("PartnerFunctionName",g.Contains,s),new h("Partner",g.Contains,s),new h("PartnerFullName",g.Contains,s)],and:false});}break;case i.includes("Operation"):if(s.endsWith("*")){a=new h({filters:[new h("MaintenanceOrderOperation",g.StartsWith,s.slice(0,-1)),new h("OperationDescription",g.StartsWith,s.slice(0,-1))],and:false});}else{a=new h({filters:[new h("MaintenanceOrderOperation",g.Contains,s),new h("OperationDescription",g.Contains,s)],and:false});}break;case i.includes("Order"):if(s.endsWith("*")){a=new h({filters:[new h("MaintenanceOrderDesc",g.StartsWith,s.slice(0,-1)),new h("MaintenanceOrderType",g.StartsWith,s.slice(0,-1)),new h("MaintenanceOrder",g.StartsWith,s.slice(0,-1)),new h("MaintenancePlanningPlant",g.StartsWith,s.slice(0,-1))],and:false});}else{a=new h({filters:[new h("MaintenanceOrderDesc",g.Contains,s),new h("MaintenanceOrderType",g.Contains,s),new h("MaintenanceOrder",g.Contains,s),new h("MaintenancePlanningPlant",g.Contains,s)],and:false});}break;case i.includes("Approvals"):if(s.endsWith("*")){a=new h({filters:[new h("WorkPermitApproval",g.StartsWith,s.slice(0,-1)),new h("WorkPermitApprovalDescription",g.StartsWith,s.slice(0,-1))],and:false});}else{a=new h({filters:[new h("WorkPermitApproval",g.Contains,s),new h("WorkPermitApprovalDescription",g.Contains,s)],and:false});}break;default:break;}return a;},getValueHelpData:function(i,W,a){var v={};switch(true){case i.includes("PPE"):v.oTable=sap.ui.getCore().byId(this.sAppId+"--PPE::Table");v.fragmentId="i2d.eam.workpermit.manages1.ext.view.fragments.AddPPEPopUp";v.vhTitle=this.i18nModel.getText("Title.PPE");v.columnModel=this.oColModel;v.path="/SafetyRequirementVH";v.valueHelp=this._oPPEValueHelpDialog;v.sPath="/to_PermitProtEquip";break;case i.includes("SPR"):v.sPath="/to_PermitSftyPrecaution";v.oTable=sap.ui.getCore().byId(this.sAppId+"--SPR::Table");v.fragmentId="i2d.eam.workpermit.manages1.ext.view.fragments.AddSPRPopUp";v.vhTitle=this.i18nModel.getText("Title.SPR");v.columnModel=this.oColModel;v.path="/SafetyRequirementVH";v.valueHelp=this._oSPRValueHelpDialog;break;case i.includes("TechObj"):v.fragmentId="i2d.eam.workpermit.manages1.ext.view.fragments.AddTechnicalObjectPopup";v.vhTitle=this.i18nModel.getText("Title.vhTechObj");v.columnModel=this.oTechObjColModel;v.path="/TechnicalObject";v.valueHelp=this._oTechObjValueHelpDialog;break;case i.includes("SafetyCert"):v.fragmentId="i2d.eam.workpermit.manages1.ext.view.fragments.AddSafetyCertificatePopUp";v.vhTitle=this.i18nModel.getText("AddSafetyCertificate");v.columnModel=this.oSafetyObjColModel;v.path="/WrkPmtSftyCertValueHelp";v.valueHelp=this._oSftyObjValueHelpDialog;break;case i.includes("Order"):v.fragmentId="i2d.eam.workpermit.manages1.ext.view.fragments.AddOrderPopUp";v.vhTitle=this.i18nModel.getText("Title.Order");v.columnModel=this.oOrderColModel;v.path="/OpenOrder";v.sorter="";v.valueHelp=this._oOrderValueHelpDialog;break;case i.includes("Approvals"):v.fragmentId="i2d.eam.workpermit.manages1.ext.view.fragments.AddApprovalsPopUp";v.vhTitle=this.i18nModel.getText("Title.AddAprovals");v.columnModel=this.oApprovalsColModel;v.path="/approvalDetails";v.valueHelp=this._oApprovalsValueHelpDialog;break;default:break;}return v;},setValueHelpData:function(o,_,a,b,v){var W=this.permitData.WorkPermit,c=this.permitData.DraftUUID;if(o.getId().includes("PPE")){this._oPPEValueHelpDialog=o;v.filterArr=new h({filters:[new h("MaintenancePlanningPlant",g.EQ,a),new h("WorkPermitType",g.EQ,b),new h("WorkPermitGroupCategory",g.EQ,"PPE")],and:true});this.getPPETableItems(_,a,b);}else if(o.getId().includes("SPR")){this._oSPRValueHelpDialog=o;v.filterArr=new h({filters:[new h("MaintenancePlanningPlant",g.EQ,a),new h("WorkPermitType",g.EQ,b),new h("WorkPermitGroupCategory",g.EQ,"SPR")],and:true});this.getSPRTableItems(_,a,b);}else if(o.getId().includes("TechObj")){this._oTechObjValueHelpDialog=o;v.filterArr=[new h("MaintenancePlanningPlant",g.EQ,a)];this.getTechObjTableItems(_,a,b);}else if(o.getId().includes("SafetyCert")){this._oSftyObjValueHelpDialog=o;this.getSftyCertTableItems(_,a);}else if(o.getId().includes("Order")){this._oOrderValueHelpDialog=o;this.getOrderTableItems(_,a);v.filterArr=[new h("MaintenancePlanningPlant",g.EQ,a)];}else if(o.getId().includes("Approvals")){this._oApprovalsValueHelpDialog=o;this.getApprovalsTableItems(_,"",c,false);v.filterArr=[new h("MaintenancePlanningPlant",g.EQ,a),new h("WorkPermitType",g.EQ,b)];}},onOpenValueHelp:function(e){var W=this.permitData.WorkPermit,a=this.permitData.DraftUUID,_=this.permitData.WorkPermitInternalID,b=this.permitData.MaintenancePlanningPlant,c=this.permitData.WorkPermitType,v=this.getValueHelpData(e.getSource().getId(),W,a);sap.ui.core.Fragment.load({name:v.fragmentId,controller:this}).then(function n(o){this.setValueHelpData(o,_,b,c,v);this.getView().addDependent(o);this.oFilterBar=o.getFilterBar();this._oBasicSearchField=new S({showSearchButton:true});this.oFilterBar.setFilterBarExpanded(false);this.oFilterBar.setBasicSearch(this._oBasicSearchField);this._oBasicSearchField.attachSearch(function(){o.getFilterBar().search();});o.getTableAsync().then(function(t){this.setVHTable(t,v);o.update();}.bind(this));o.open();}.bind(this));},searchFilterItem:function(){this.oFilterBar.search();},setVHTable:function(t,v){var c;t.setModel(this.oModel);if(t.getId()!=="permitVHAddSafetyCert-table"){c=v.columnModel.getProperty("/cols");t.setModel(v.columnModel,"columns");}if(t.bindRows){t.bindAggregation("rows",{path:v.path,filters:v.filterArr});if(t.getId()==="permitVHAddSafetyCert-table"){this.createSafetyCertificateColumn(t);}}if(t.bindItems){t.bindAggregation("items",v.path,function(){return new sap.m.ColumnListItem({cells:c.map(function(a){return new sap.m.Label({text:"{"+a.template+"}"});})});});}},createSafetyCertificateColumn:function(t){var v=new sap.m.Text({text:{path:"ValidFromDateTime",type:'sap.ui.model.type.Date',formatOptions:{pattern:'dd.MM.yyyy HH:mm:ss'}}});var a=new sap.m.Text({text:{path:"ValidToDateTime",type:'sap.ui.model.type.Date',formatOptions:{pattern:'dd.MM.yyyy HH:mm:ss'}}});t.addColumn(new U({label:new L({text:this.i18nModel.getText("SftyCertificateNumber")}),template:new l({wrapping:false,text:"{SafetyCertificate}"}),width:"10em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("Description")}),template:new l({wrapping:false,text:"{SftyCertDesc}"}),width:"16em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("SftyCertificateType")}),template:new l({wrapping:false,text:"{SafetyCertificateType}"}),width:"12em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("SftyCertTypeDesc")}),template:new l({wrapping:false,text:"{SftyCertificateTypeDescription}"}),width:"18em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("Label.PlanningPlant")}),template:new l({wrapping:false,text:"{MaintenancePlanningPlant}"}),width:"8em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("PlanningPlantDescTitle")}),template:new l({wrapping:false,text:"{PlantName}"}),width:"12em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("TechnicalObject")}),template:new l({wrapping:false,text:"{TechnicalObjectLabel}"}),width:"8em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("TechnicalObjectDescription")}),template:new l({wrapping:false,text:"{TechnicalObjectDescription}"}),width:"12em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("Title.ValidFromDateTime")}),template:v,width:"10em"}));t.addColumn(new U({label:new L({text:"Validity End"}),template:a,width:"10em"}));t.addColumn(new U({label:new L({text:this.i18nModel.getText("Title.ProcessingStatus")}),template:new l({wrapping:false,text:"{SftyCertProcessingStatusText}"}),width:"12em"}));},handleClose:function(e){e.getSource().close();e.getSource().destroy();},onFilterBarSearch:function(e){var s=e.getSource().getBasicSearchValue(),a=e.getParameter("selectionSet"),b=this.getSearchHelpFilters(e.getSource().getId(),s),v=this.getValueHelpData(e.getSource().getId()),V=v.valueHelp,c;if(a[0].getId().includes("Order")){c=a.reduce(function(r,C){if(C.getValue()){var i=C.getValue();if(i.endsWith("*")){r.push(new h({path:C.getName(),operator:g.StartsWith,value1:i.slice(0,-1)}));}else{r.push(new h({path:C.getName(),operator:g.Contains,value1:i}));}}return r;},[]);}else if(a[0].getId().includes("TechObj")){c=a.reduce(function(r,C){if(C.getId()==="idTechObjTyp"){if(C.getSelectedKeys().length>0){var t=[];for(var i=0;i<C.getSelectedKeys().length;i++){var j='';if(C.getSelectedKeys()[i].endsWith("*")){j=new h({path:"TechObjIsEquipOrFuncnlLoc",operator:g.StartsWith,value1:C.getSelectedKeys()[i].slice(0,-1)});}else{j=new h({path:"TechObjIsEquipOrFuncnlLoc",operator:g.Contains,value1:C.getSelectedKeys()[i]});}t.push(j);}r.push(new h({filters:t,and:false}));}}else{if(C.getValue()){if(C.getValue().endsWith("*")){r.push(new h({path:C.getName(),operator:g.StartsWith,value1:C.getValue().slice(0,-1)}));}else{r.push(new h({path:C.getName(),operator:g.Contains,value1:C.getValue()}));}}}return r;},[]);}else{c=a.reduce(function(r,C){if(C.getValue()){if(C.getValue().endsWith("*")){r.push(new h({path:C.getName(),operator:g.StartsWith,value1:C.getValue().slice(0,-1)}));}else{r.push(new h({path:C.getName(),operator:g.Contains,value1:C.getValue()}));}}return r;},[]);}c.push(b);this._filterTable(new h({filters:c,and:true}),V);},_filterTable:function(o,v){v.getTableAsync().then(function(t){if(t.bindRows){t.getBinding("rows").filter(o);}if(t.bindItems){t.getBinding("items").filter(o);}v.update();});},getSPRTableItems:function(o,p){this._oSPRValueHelpDialog.setBusy(true);this.oModel.read("/WorkPermitSafetyPracaution?",{filters:[new h("WorkPermitInternalID",g.EQ,o),new h("IsActiveEntity",g.EQ,false)],success:function(D){this.SPRItems=D.results;this._oSPRValueHelpDialog.setBusy(false);}.bind(this),error:function(D){this._oSPRValueHelpDialog.setBusy(false);}.bind(this)});},handleSPRConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var a=e.getSource(),v=this.getValueHelpData(e.getSource().getId()),t=v.oTable;if(e.getParameters().tokens.length>0){this._oSafetyLength=0;this.oModel.setDeferredGroups(["NewSafetyPrecautionItem"]);var s=e.getSource()._oSelectedTokens.getTokens();for(var i=0;i<s.length;i++){this.safetyItemAvailable=false;var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()];for(var j=0;j<this.SPRItems.length;j++){if(I.WrkPmtSafetyRequirementGroup===this.SPRItems[j].WrkPmtSafetyRequirementGroup&&I.WorkPermitSafetyRequirement===this.SPRItems[j].WorkPermitSafetyRequirement){this.safetyItemAvailable=true;this._oSafetyLength+=1;break;}}if(this.safetyItemAvailable===false){var c="";if(I.WrkPmtSftyRqmtIsImplemented){c=this.i18nModel.getText("NotImplemented");}else{c=this.i18nModel.getText("NotApplicable");}this.oModel.createEntry(e.getSource().getBindingContext().sPath+v.sPath,{groupId:"NewSafetyPrecautionItem",properties:{"WorkPermitGroupCategory":I.WorkPermitGroupCategory,"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"WrkPmtSftyRequirementGroupText":I.WrkPmtSftyRequirementGroupText,"WorkPermit":this.permitData.WorkPermit,"WrkPmtSafetyRequirementGroup":I.WrkPmtSafetyRequirementGroup,"WorkPermitSafetyRequirement":I.WorkPermitSafetyRequirement,"MaintenancePlanningPlant":I.MaintenancePlanningPlant,"WorkPermitType":I.WorkPermitType,"WrkPmtSafetyRequirementText":I.WrkPmtSafetyRequirementText,"CriticalityText":c,"IsActiveEntity":false}});}}this.submitBatchChanges(a,t,"NewSafetyPrecautionItem");}else{sap.ui.core.BusyIndicator.hide();a.setBusy(false);a.close();a.destroy();}},getPPETableItems:function(o,p){this._oPPEValueHelpDialog.setBusy(true);this.oModel.read("/WorkPermitProtEqip?",{filters:[new h("WorkPermitInternalID",g.EQ,o),new h("IsActiveEntity",g.EQ,false)],success:function(D){this.PPEItems=D.results;this._oPPEValueHelpDialog.setBusy(false);}.bind(this),error:function(D){this._oPPEValueHelpDialog.setBusy(false);}.bind(this)});},handlePPEConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var P=e.getSource(),v=this.getValueHelpData(e.getSource().getId()),t=v.oTable;if(e.getParameters().tokens.length>0){this._oPPELength=0;this.oModel.setDeferredGroups(["NewPrsnlProctEqipmentItem"]);var s=e.getSource()._oSelectedTokens.getTokens();for(var i=0;i<s.length;i++){this.ppeItemAvailable=false;var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()];for(var j=0;j<this.PPEItems.length;j++){if(I.WrkPmtSafetyRequirementGroup===this.PPEItems[j].WrkPmtSafetyRequirementGroup&&I.WorkPermitSafetyRequirement===this.PPEItems[j].WorkPermitSafetyRequirement){this.ppeItemAvailable=true;this._oPPELength+=1;break;}}if(this.ppeItemAvailable===false){this.oModel.createEntry(e.getSource().getBindingContext().sPath+v.sPath,{groupId:"NewPrsnlProctEqipmentItem",properties:{"WorkPermitGroupCategory":I.WorkPermitGroupCategory,"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"WrkPmtSftyRequirementGroupText":I.WrkPmtSftyRequirementGroupText,"WorkPermit":this.permitData.WorkPermit,"WrkPmtSafetyRequirementGroup":I.WrkPmtSafetyRequirementGroup,"WorkPermitSafetyRequirement":I.WorkPermitSafetyRequirement,"MaintenancePlanningPlant":I.MaintenancePlanningPlant,"WorkPermitType":I.WorkPermitType,"WrkPmtSafetyRequirementText":I.WrkPmtSafetyRequirementText,"IsActiveEntity":false}});}}this.submitBatchChanges(P,t,"NewPrsnlProctEqipmentItem");}else{sap.ui.core.BusyIndicator.hide();P.setBusy(false);P.close();P.destroy();}},getOrderTableItems:function(p){this._oOrderValueHelpDialog.setBusy(true);this.oModel.read("/WorkPermitOrder?$orderby=OrderType asc",{filters:[new h("WorkPermitInternalID",g.EQ,p),new h("IsActiveEntity",g.EQ,false)],success:function(D){this.OrderData=D.results;this._oOrderValueHelpDialog.setBusy(false);}.bind(this),error:function(D){this._oOrderValueHelpDialog.setBusy(false);}.bind(this)});},handleOrderConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var O=e.getSource(),c=sap.ui.getCore().byId(this.sAppId+"--ord::Table"),s=e.getSource().getTable().getSelectedIndices().length;if(e.getParameters().tokens.length>0){this._OrderLength=0;for(var i=0;i<s;i++){this._OrderAvailable=false;var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()];this.oModel.setDeferredGroups(["NewOrderItems"]);for(var j=0;j<this.OrderData.length;j++){if(I.MaintenanceOrder===this.OrderData[j].MaintenanceOrder){this._OrderAvailable=true;this._OrderLength+=1;break;}}if(this._OrderAvailable===false){this.oModel.createEntry(e.getSource().getBindingContext().sPath+"/to_WorkPermitOrder",{groupId:"NewOrderItems",properties:{"MaintenanceOrder":I.MaintenanceOrder,"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"MaintenanceOrderInternalID":I.MaintenanceOrderInternalID,"WorkPermitObjectType":"WA","WorkPermitOrderObjectType":"OR","IsActiveEntity":false}});}}this.submitBatchChanges(O,c,"NewOrderItems");}else{sap.ui.core.BusyIndicator.hide();O.setBusy(false);O.close();O.destroy();}},onPressUnAssignOrderAction:function(e){var O,c,C,p,m;c=sap.ui.getCore().byId(this.sAppId+"--ord::responsiveTable");O=c.getSelectedItem();m=this.i18nModel.getText("Error.Item_Deleted");C=c.getSelectedItem().getBindingContext().getObject();p=this.getView().getBindingContext().getObject();M.warning(this.i18nModel.getText("Error.OrderDelete"),{title:this.i18nModel.getText("Title.Delete"),actions:["Remove",M.Action.CANCEL],emphasizedAction:"Remove ",onClose:function(a){if(a==="Remove"){O.setBusy(true);this.oModel.callFunction("/UnassignJobs",{method:"POST",urlParameters:{"WorkPermit":p.WorkPermit,"MaintenanceOrder":C.MaintenanceOrder,"WorkPermitInternalID":C.WorkPermitInternalID,"MaintenanceOrderInternalID":C.MaintenanceOrderInternalID,"DraftUUID":p.DraftUUID,"WorkPermitOrderDraftUUID":C.DraftUUID,"IsActiveEntity":p.IsActiveEntity},success:function(D){c.getParent().rebindTable();O.setBusy(false);k.show(this.i18nModel.getText(m));}.bind(this),error:function(E){O.setBusy(false);}});}}.bind(this)});},getSftyCertTableItems:function(o,p){this._oSftyObjValueHelpDialog.setBusy(true);this.oModel.read("/WrkPmtSafetyCertificate?",{filters:[new h("WorkPermitInternalID",g.EQ,o),new h("MaintenancePlanningPlant",g.EQ,p),new h("IsActiveEntity",g.EQ,false)],success:function(D){this.SafetyObject=D.results;this._oSftyObjValueHelpDialog.setBusy(false);}.bind(this),error:function(D){this._oSftyObjValueHelpDialog.setBusy(false);}.bind(this)});},handleSafetyConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var a=e.getSource(),s=sap.ui.getCore().byId(this.sAppId+"--SC::Table"),o=e.getSource().getTable().getSelectedIndices().length;if(e.getParameters().tokens.length>0){this._oSftyObjLen=0;for(var i=0;i<o;i++){this.sftyObjectAvailable=false;var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()];this.oModel.setDeferredGroups(["NewSftyObjItems"]);for(var j=0;j<this.SafetyObject.length;j++){if(I.SafetyCertificate===this.SafetyObject[j].SafetyCertificate){this.sftyObjectAvailable=true;this._oSftyObjLen+=1;break;}}if(this.sftyObjectAvailable===false){this.oModel.createEntry(e.getSource().getBindingContext().sPath+"/to_WrkPmtSafetyCertificate",{groupId:"NewSftyObjItems",properties:{"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"SafetyCertificate":I.SafetyCertificate,"SafetyCertificateInternalID":I.SafetyCertificateInternalID,"SafetyCertificateType":I.SafetyCertificateType,"MaintenancePlanningPlant":I.MaintenancePlanningPlant,"WorkPermitObjectType":"WA","SftyCertWrkPmtObjectType":"WD","IsActiveEntity":false}});}}this.submitBatchChanges(a,s,"NewSftyObjItems");}else{sap.ui.core.BusyIndicator.hide();a.setBusy(false);a.close();a.destroy();}},getTechObjTableItems:function(o,p){this._oTechObjValueHelpDialog.setBusy(true);this.oModel.read("/WorkPermitTechnicalObject?$orderby=TechnicalObject asc",{filters:[new h("WorkPermitInternalID",g.EQ,o),new h("MaintenancePlanningPlant",g.EQ,p),new h("IsActiveEntity",g.EQ,false)],success:function(D){this.TechnicalObjects=D.results;this._oTechObjValueHelpDialog.setBusy(false);}.bind(this),error:function(D){this._oTechObjValueHelpDialog.setBusy(false);}.bind(this)});},handleConfirmTechObj:function(e){sap.ui.core.BusyIndicator.show(0);var a=e.getSource(),t=sap.ui.getCore().byId(this.sAppId+"--TechObj::Table"),s=e.getSource().getTable().getSelectedIndices().length;if(e.getParameters().tokens.length>0){this._oTechObjLen=0;for(var i=0;i<s;i++){this.techObjectAvailable=false;var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()],b;if(I.TechObjIsEquipOrFuncnlLocDesc==="Equipment"){b="E";}else{b="F";}this.oModel.setDeferredGroups(["NewTechObjItems"]);for(var j=0;j<this.TechnicalObjects.length;j++){if(I.TechnicalObjectLabel===this.TechnicalObjects[j].TechnicalObjectLabel){this.techObjectAvailable=true;this._oTechObjLen+=1;break;}}if(this.techObjectAvailable===false){this.oModel.createEntry(e.getSource().getBindingContext().sPath+"/to_TechnicalObject",{groupId:"NewTechObjItems",properties:{"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"TechnicalObjectLabel":I.TechnicalObjectLabel,"TechnicalObject":I.TechnicalObject,"SftyCertItemCatType":b,"MaintenancePlant":I.MaintenancePlant,"MaintenancePlanningPlant":I.MaintenancePlanningPlant,"TechnicalObjectDescription":I.TechnicalObjectDescription,"TechObjIsEquipOrFuncnlLocDesc":I.TechObjIsEquipOrFuncnlLocDesc,"MaintObjectInternalID":I.MaintObjectInternalID,"IsActiveEntity":false}});}}this.submitBatchChanges(a,t,"NewTechObjItems");}else{sap.ui.core.BusyIndicator.hide();a.setBusy(false);a.close();a.destroy();}},onOpenAddPartnerDialog:function(e){if(!this.onPartnerDialog){this.onPartnerDialog=sap.ui.xmlfragment("idPartnerDialog","i2d.eam.workpermit.manages1.ext.view.fragments.AddPartnerPopUp",this);this.getView().addDependent(this.onPartnerDialog);}this.onPartnerDialog.open();this.onPartnerDialog.setModel(this.oModel);var a=new h("MaintenancePlanningPlant",g.EQ,this.permitData.MaintenancePlanningPlant);sap.ui.core.Fragment.byId("idPartnerDialog","permitInputPartner").getBinding("items").filter([a]);sap.ui.core.Fragment.byId("idPartnerDialog","permitInputPartner").setValue("");},handlePartnerConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var p=sap.ui.core.Fragment.byId("idPartnerDialog","idPartnerDialog"),c=sap.ui.getCore().byId(this.sAppId+"--Partner::Table"),a=sap.ui.core.Fragment.byId("idPartnerDialog","permitInputPartner");this._oCounter=sap.ui.getCore().byId(this.sAppId+"--Partner::responsiveTable").getItems().length;if(a.getSelectedKey()!==""){this.oModel.setDeferredGroups(["AddPartner"]);this.oModel.createEntry(e.getSource().getBindingContext().sPath+"/to_WorkPermitPartner",{groupId:"AddPartner",properties:{"PartnerFunction":a.getSelectedKey(),"MaintenancePartnerObjectNumber":(this._oCounter+1).toString(),"MaintObjectInternalID":this.permitData.WorkPermitInternalID,"MaintObjectCategory":"WAI","PartnerFunctionName":a.getSelectedItem().getText(),"MaintenancePlanningPlant":this.permitData.MaintenancePlanningPlant,"CreatedByUser":sap.ushell.Container.getService("UserInfo").getId(),"CreationDate":new Date(),"IsActiveEntity":false}});this._oCounter++;this.submitBatchChanges(p,c,"AddPartner");}else{sap.ui.core.BusyIndicator.hide();p.setBusy(false);p.close();}},handlePartnerClose:function(){this.onPartnerDialog.close();},submitBatchChanges:function(v,t,b){v.setBusy(true);this.oModel.submitChanges({batchGroupId:b,success:function(D){if(t.getId().includes("Partner")){sap.ui.core.BusyIndicator.hide();v.setBusy(false);this.onPartnerDialog.close();t.rebindTable();return;}if(b==="NewOperationItems"){this.UpdateOperationCount(this.operationCount);}else{t.rebindTable();}if(b==="NewSftyObjItems"){var p=sap.ui.getCore().byId(this.sAppId+"--PA::Table");p.rebindTable();}sap.ui.core.BusyIndicator.hide();v.setBusy(false);v.close();v.destroy();this.handleDuplicateMsg(t);}.bind(this),error:function(e){v.setBusy(false);}});},handleDuplicateMsg:function(t){if(this._oSafetyLength>1){k.show(this.i18nModel.getText("Message.SPRExists"));}else if(this._oSafetyLength===1){k.show(this.i18nModel.getText("Message.SPRExist"));}if(this._oPPELength>1){k.show(this.i18nModel.getText("Message.PPEExists1"));}else if(this._oPPELength===1){k.show(this.i18nModel.getText("Message.PPEExist"));}if(this._oSftyObjLen>1){k.show(this.i18nModel.getText("Message.SftyExists1"));}else if(this._oSftyObjLen===1){k.show(this.i18nModel.getText("Message.SftyExist"));}if(this._oTechObjLen>1){k.show(this.i18nModel.getText("Message.TechObjs"));}else if(this._oTechObjLen===1){k.show(this.i18nModel.getText("Message.TechObj"));}if(this._OrderLength>1){k.show(this.i18nModel.getText("Message.Orders"));}else if(this._OrderLength===1){k.show(this.i18nModel.getText("Message.Order"));}if(this._OperationLength>1){k.show(this.i18nModel.getText("Message.Operations"),{duration:3600,width:"15rem"});}else if(this._OperationLength===1){k.show(this.i18nModel.getText("Message.Operation"),{duration:3600,width:"15rem"});}if(this._oApprovalsLength>1){k.show(this.i18nModel.getText("Message.Approvals"));}else if(this._oApprovalsLength===1){k.show(this.i18nModel.getText("Message.Approval"));}this._oTechObjLen=0;this._OrderLength=0;this._OperationLength=0;this._oSafetyLength=0;this._oPPELength=0;this._oApprovalsLength=0;},getApprovalsTableItems:function(W,a,D,I){this._oApprovalsValueHelpDialog.setBusy(true);this.oModel.read("/WorkPermitApproval",{filters:[new h("WorkPermitInternalID",g.EQ,W),new h("IsActiveEntity",g.EQ,false)],success:function(o){this._oApprovalsCounter=o.results.length;this.approvalsData=o.results;this._oApprovalsValueHelpDialog.setBusy(false);}.bind(this),error:function(o){this._oApprovalsValueHelpDialog.setBusy(false);}.bind(this)});},handleApprovalsConfirm:function(e){sap.ui.core.BusyIndicator.show(0);var a=e.getSource(),s=e.getSource().getTable().getSelectedIndices().length,c=sap.ui.getCore().byId(this.sAppId+"--APPR1::Table");if(e.getParameters().tokens.length>0){this._oApprovalsLength=0;for(var i=0;i<s;i++){this._ApprovalsAvailable=false;this.oModel.setDeferredGroups(["AddApprovals"]);var I=e.getSource()._oSelectedItems.items[e.getSource()._oSelectedTokens.getTokens()[i].getKey()];for(var j=0;j<this.approvalsData.length;j++){if(I.WorkPermitApproval===this.approvalsData[j].WorkPermitApproval){this._ApprovalsAvailable=true;this._oApprovalsLength+=1;break;}}if(this._ApprovalsAvailable===false){this.oModel.createEntry(e.getSource().getBindingContext().sPath+"/to_WorkPermitApproval",{groupId:"AddApprovals",properties:{"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"IsActiveEntity":false,WorkPermitApprovalDescription:I.WorkPermitApprovalDescription,Mandatory:I.Mandatory,WrkPmtApprovalHierarchyLevel:I.WrkPmtApprovalHierarchyLevel,WorkPermitApproval:I.WorkPermitApproval,WrkPmtApprvlMandText:I.WrkPmtApprvlMandText,NumberOfWrkPermitApprovals:(this._oApprovalsCounter+1).toString()}});this._oApprovalsCounter++;}}this.submitBatchChanges(a,c,"AddApprovals");}else{sap.ui.core.BusyIndicator.hide();a.setBusy(false);a.close();a.destroy();}},onClickCancelWorkPermit:function(e){M.warning(this.i18nModel.getText("CancelWorkPermitMsg"),{title:this.i18nModel.getText("idCancelWorkPermitButton"),icon:M.Icon.warning,actions:[M.Action.YES,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(a){if(a==="YES"){sap.ui.core.BusyIndicator.show(0);this.callCancelWorkPermitAction();}}.bind(this)});},callCancelWorkPermitAction:function(){if(!this.oSubmitDialog){this.oSubmitDialog=new sap.m.Dialog({type:sap.m.DialogType.Message,title:this.i18nModel.getText("Title.Cancel"),content:[new T("cancelRsnWrkPmt",{width:"480px",placeholder:this.i18nModel.getText("Label.PermitCancelPopup"),liveChange:function(e){var t=e.getParameter("value");this.oSubmitDialog.getBeginButton().setEnabled(t.length>0);}.bind(this)})],beginButton:new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:this.i18nModel.getText("Button.CancelConfirm"),enabled:false,press:function(e){var a=sap.ui.getCore().byId("cancelRsnWrkPmt").getValue();this.getView().setBusy(true);this.oModel.callFunction("/Cancel",{method:"POST",urlParameters:{WorkPermitLongText:a,WorkPermit:this.permitData.WorkPermit,MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,DraftUUID:this.permitData.DraftUUID,WorkPermitInternalID:this.permitData.WorkPermitInternalID,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){if(D.Cancel.WorkPermitCancelIsAllowed===false){sap.ui.getCore().byId("idCancelButton").setVisible(false);}if(D.Cancel.SystemMessageType==="E"){M.error(D.Cancel.SystemMessageText);sap.ui.getCore().byId("idCancelButton").setVisible(true);this.getView().setBusy(false);return;}this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();this.navigateToDisplayMode();}.bind(this),error:function(E){this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();this.handleAuthError(E);}.bind(this)});this.oSubmitDialog.close();}.bind(this)}),endButton:new sap.m.Button({text:"Discard",press:function(){this.oSubmitDialog.close();}.bind(this)})});}sap.ui.getCore().byId("cancelRsnWrkPmt").setValue("");this.oSubmitDialog.open();},onClickSetInactiveFlag:function(e){M.confirm(this.i18nModel.getText("SetInactiveFlagMsg"),{title:this.i18nModel.getText("idSetInactiveFlagButton"),icon:M.Icon.INFORMATION,actions:[M.Action.OK,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(a){if(a==="OK"){sap.ui.core.BusyIndicator.show(0);this.callSetInactiveFlagAction(true);}}.bind(this)});},onClickResetInactiveFlag:function(e){M.confirm(this.i18nModel.getText("ResetInactiveFlagMsg"),{title:this.i18nModel.getText("idResetInactiveFlagButton"),icon:M.Icon.INFORMATION,actions:[M.Action.OK,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(a){if(a==="OK"){sap.ui.core.BusyIndicator.show(0);this.callSetInactiveFlagAction(false);}}.bind(this)});},callSubmitForApprovalAction:function(s){this.getView().setBusy(true);this.Ispproved=s;this.oModel.callFunction("/SubmitForApproval",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,WorkPermit:this.permitData.WorkPermit,WorkPermitInternalID:this.permitData.WorkPermitInternalID,IsApproved:s,DraftUUID:this.permitData.DraftUUID,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){this.IsApproved=s;this.getView().setBusy(false);if(s){k.show(this.i18nModel.getText("SubmitForApprovalMsg"));}else{k.show(this.i18nModel.getText("RevokeMsgConfirm"));}sap.ui.core.BusyIndicator.hide();this.navigateToDisplayMode();}.bind(this),error:function(r){this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();var m=JSON.parse(r.responseText).error.message.value;sap.m.MessageBox.error(m);}.bind(this)});},callSetInactiveFlagAction:function(s){this.getView().setBusy(true);this.Ispproved=s;this.oModel.callFunction("/Deactivate",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,WorkPermit:this.permitData.WorkPermit,WorkPermitInternalID:this.permitData.WorkPermitInternalID,StatusIsInactive:s?"":"X",WorkPermitProcessingStatus:this.permitData.WorkPermitProcessingStatus,DraftUUID:this.permitData.DraftUUID,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){this.IsApproved=s;if(s){k.show(this.i18nModel.getText("InactiveStatusMsg"));}else{k.show(this.i18nModel.getText("ResetInacMsgConfirm"));}this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();this.navigateToDisplayMode();}.bind(this),error:function(r){this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();var m=JSON.parse(r.responseText).error.message.value;sap.m.MessageBox.error(m);}.bind(this)});},onPressLongText:function(e){var p=e.getSource(),P;if(e.getSource().getParent().getBindingContext().getObject().PlainLongText.length>0){if(!P){P=new sap.m.ResponsivePopover({title:this.i18nModel.getText("Title.ApprvComments"),placement:"Left",contentWidth:"300px",contentHeight:"250px",content:[new sap.m.Text({text:e.getSource().getParent().getBindingContext().getObject().PlainLongText})]});}P.openBy(p);}},onPressRevokeLongText:function(e){var p=e.getSource(),P;if(e.getSource().getParent().getBindingContext().getObject().WorkPermitRevokeLongText.length>0){if(!P){P=new sap.m.ResponsivePopover({title:this.i18nModel.getText("RevokeHistoryComment"),placement:"Left",contentWidth:"300px",contentHeight:"250px",content:[new sap.m.Text({text:e.getSource().getParent().getBindingContext().getObject().WorkPermitRevokeLongText})]});}P.openBy(p);}},onClickPrint:function(e){var p=e.getSource().getText();M.warning(this.i18nModel.getText("PrintPermitMsg"),{title:this.i18nModel.getText("PrintWorkPermitMsg"),icon:M.Icon.warning,actions:[M.Action.YES,M.Action.NO],emphasizedAction:M.Action.YES,onClose:function(a){if(a==="YES"){sap.ui.core.BusyIndicator.show(0);this.onClickPrintPermit(p);}}.bind(this)});},onClickPrintPermit:function(p){var a=this.i18nModel.getText("Print");if(p===a){var b="00001";}else{b="00002";}this.getView().setBusy(true);this.oModel.callFunction("/PrintWorkPermit",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,WorkPermit:this.permitData.WorkPermit,WorkPermitInternalID:this.permitData.WorkPermitInternalID,DraftUUID:this.permitData.DraftUUID,ValidationScenarioID:b,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();sap.ui.getCore().byId("idCombineChangeidReissueWrkPmtButton").setVisible(true);var c=D.PrintWorkPermit.WorkPermitOutputDataBinary;var e=atob(c);var j=new Uint8Array(e.length);for(var i=0;i<e.length;i++){j[i]=e.charCodeAt(i);}var m=new Blob([j.buffer],{type:'application/pdf'});var _=URL.createObjectURL(m);if(!this._PDFViewer){this._PDFViewer=new sap.m.PDFViewer({width:"auto",source:_,showDownloadButton:false,isTrustedSource:true});jQuery.sap.addUrlWhitelist("blob");}this._PDFViewer.open();this.navigateToDisplayMode();}.bind(this),error:function(e){this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();M.error(JSON.parse(e.responseText).error.message.value);}.bind(this)});},onClickIssueWrkPmt:function(e){M.confirm(this.i18nModel.getText("SetIssueWrkPmtMsg"),{title:this.i18nModel.getText("idSetIssueFlagButton"),icon:M.Icon.INFORMATION,actions:[M.Action.OK,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(a){if(a==="OK"&&!this.permitData.WrkPmtIssueHistoryIsAllowed){sap.ui.core.BusyIndicator.show(0);this.callIssueWrkPmtAction(true);}else if(a==="OK"&&this.permitData.WrkPmtIssueHistoryIsAllowed){this.callAddPersonRespPopUp(true);}}.bind(this)});},onClickReissueWrkPmt:function(e){M.confirm(this.i18nModel.getText("HandoutApprovalMsg"),{title:this.i18nModel.getText("idReissueWrkPmtButton"),icon:M.Icon.INFORMATION,actions:[M.Action.OK,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(a){if(a==="OK"&&!this.permitData.WrkPmtIssueHistoryIsAllowed){sap.ui.core.BusyIndicator.show(0);this.callIssueWrkPmtAction(true);}else if(a==="OK"&&this.permitData.WrkPmtIssueHistoryIsAllowed){this.callAddPersonRespPopUp(true);}}.bind(this)});},callAddPersonRespPopUp:function(s){this.oIssueFlag=s;if(!this.onIssuePermitDialog){this.onIssuePermitDialog=sap.ui.xmlfragment("idIssuePermitDialog","i2d.eam.workpermit.manages1.ext.view.fragments.WorkPermitIssueTechnicianPopUp",this);this.getView().addDependent(this.onIssuePermitDialog);}this.onIssuePermitDialog.open();this.idTechnician=sap.ui.core.Fragment.byId("idIssuePermitDialog","permitInputTech");this.idComment=sap.ui.core.Fragment.byId("idIssuePermitDialog","permitInputIssueComment");this.continueBtn=sap.ui.core.Fragment.byId("idIssuePermitDialog","permitButtonHandOutPermit");this.continueBtn.setBlocked(true);this.clearIssuePopupFields();jQuery.sap.delayedCall(500,this,function(){this.idTechnician.focus();});},clearIssuePopupFields:function(){this.idTechnician.setValue("");this.idComment.setValue("");this.newPPValue="";this.newPTValue="";this.newRefValue="";},handleClosePopupButton:function(e){this.onIssuePermitDialog.close();},handleIssuePermitButton:function(e){if(this.TechId!==""&&!this.continueBtn.getBlocked()){this.onIssuePermitDialog.close();this.HistPath=e.getSource().getBindingContext().sPath;this.CommentId=this.idComment.getValue();var t=this;if(this.TechId!==undefined||this.CommentId){this.callIssueWrkPmtActn(this.oIssueFlag);}else{sap.ui.core.BusyIndicator.show(0);this.callIssueWrkPmtAction(this.oIssueFlag);}}},handleTechValueChange:function(e){this.TechId=e.getParameters().newValue;if(this.TechId!==""){this.validateTechn(this.TechId);}else{this.continueBtn.setBlocked(true);}},handleCommentChange:function(e){this.oComment=e.getParameters().newValue;},submitCreateBatch:function(b){sap.ui.core.BusyIndicator.show(0);this.oModel.setDeferredGroups(this.oModel.getDeferredGroups().concat(["SavePermit"]));this.oModel.submitChanges({batchGroupId:b,success:function(D){sap.ui.core.BusyIndicator.hide();this.navigateToDisplayMode();}.bind(this),error:function(e){}});},callIssueWrkPmtAction:function(s){this.getView().setBusy(true);this.Ispproved=s;this.oModel.resetChanges();this.oModel.callFunction("/IssueWorkPermit",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,WorkPermit:this.permitData.WorkPermit,WorkPermitInternalID:this.permitData.WorkPermitInternalID,WorkPermitIsIssued:s,DraftUUID:this.permitData.DraftUUID,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){this.IsApproved=s;if(s){k.show(this.i18nModel.getText("IssueStatusMsg"));}else{k.show(this.i18nModel.getText("ReissueMsgConfirm"));}this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();this.navigateToDisplayMode();}.bind(this),error:function(r){this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();var m=JSON.parse(r.responseText).error.message.value;sap.m.MessageBox.error(m);}.bind(this)});},callIssueWrkPmtActn:function(s){this.getView().setBusy(true);this.Ispproved=s;this.oModel.resetChanges();this.oModel.setDeferredGroups(this.oModel.getDeferredGroups().concat(["IssuePermit"]));this.oModel.callFunction("/IssueWorkPermit",{method:"POST",groupId:"IssuePermit",urlParameters:{MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,WorkPermit:this.permitData.WorkPermit,WorkPermitInternalID:this.permitData.WorkPermitInternalID,WorkPermitIsIssued:s,DraftUUID:this.permitData.DraftUUID,IsActiveEntity:this.permitData.IsActiveEntity}});this.oModel.submitChanges({batchGroupId:"IssuePermit",success:function(D){var r=D.__batchResponses[0].__changeResponses;if(!r){this.getView().setBusy(false);var m=JSON.parse(D.__batchResponses[0].response.body).error.message.value;sap.m.MessageBox.error(m);}else{this.IsApproved=s;this.oModel.setDeferredGroups(this.oModel.getDeferredGroups().concat(["PermitHist"]));this.oModel.createEntry(this.HistPath+"/to_WorkPermitIssHist",{groupId:"PermitHist",properties:{"WorkPermitInternalID":this.permitData.WorkPermitInternalID,"NumberOfWorkPermitIssued":D.__batchResponses[0].__changeResponses[0].data.IssueWorkPermit.NumberOfWorkPermitIssued,"WorkPermitIssuedBy":D.__batchResponses[0].__changeResponses[0].data.IssueWorkPermit.CreatedByUser,"WorkPermitIssuedTo":this.TechId,"UserCommentsText":this.CommentId,"WorkPermitIssueDateTime":D.__batchResponses[0].__changeResponses[0].data.IssueWorkPermit.CreationDateTime,"IsActiveEntity":false}});this.HistPath="";this.TechId="";this.submitCreateBatch("PermitHist");if(s){k.show(this.i18nModel.getText("IssueStatusMsg"));}else{k.show(this.i18nModel.getText("ReissueMsgConfirm"));}}this.getView().setBusy(false);}.bind(this),error:function(r){this.getView().setBusy(false);var m=JSON.parse(r.responseText).error.message.value;sap.m.MessageBox.error(m);}.bind(this)});},onClickCloseWorkPermit:function(e){M.warning(this.i18nModel.getText("CloseWorkPermitMsg"),{title:this.i18nModel.getText("idCloseWorkPermitButton"),icon:M.Icon.warning,actions:[M.Action.YES,M.Action.CANCEL],emphasizedAction:M.Action.OK,onClose:function(a){if(a==="YES"){sap.ui.core.BusyIndicator.show(0);this.callCloseWorkPermitAction();}}.bind(this)});},callCloseWorkPermitAction:function(){this.getView().setBusy(true);this.oModel.callFunction("/SetProcessingStatusToClosed",{method:"POST",urlParameters:{MaintenancePlanningPlant:this.permitData.MaintenancePlanningPlant,WorkPermit:this.permitData.WorkPermit,WorkPermitInternalID:this.permitData.WorkPermitInternalID,DraftUUID:this.permitData.DraftUUID,IsActiveEntity:this.permitData.IsActiveEntity},success:function(D){sap.ui.getCore().byId("ObjectPageMenuButtonIdStatus").setVisible(false);this.getView().setBusy(false);sap.ui.core.BusyIndicator.hide();this.navigateToDisplayMode();}.bind(this),error:function(e){this.getView().setBusy(false);this.handleAuthError(e);}.bind(this)});},onExit:function(e){if(this.oApproveWrkPmtSubmitDialog){this.oApproveWrkPmtSubmitDialog.destroy();delete this.oApproveWrkPmtSubmitDialog;}},setCreatePermitParameterValues:function(){var u=window.location;var s=new URL(u.hash.replace("#",u.origin+"/")).searchParams;var m=s.get("ActiveMaintenanceOrder");var a=s.get("MaintenancePlanningPlant");if(a){this.newPPValue=a;this.validateAuthorization(this.newPPValue);this.idPlanningPlant.setValue(a);}if(m){this.idMaintorder.setValue(m);}}});});
